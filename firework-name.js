var w=c.width=window.innerWidth,h=c.height=window.innerHeight,ctx=c.getContext("2d"),hw=w/2,hh=h/2,opts={strings:["FELIZ","NAVIDAD"],charSize:30,charSpacing:35,lineHeight:40,cx:w/2,cy:h/2,fireworkPrevPoints:6,fireworkBaseLineWidth:4,fireworkAddedLineWidth:6,fireworkSpawnTime:120,fireworkBaseReachTime:20,fireworkAddedReachTime:20,fireworkCircleBaseSize:12,fireworkCircleAddedSize:6,fireworkCircleBaseTime:20,fireworkCircleAddedTime:20,fireworkCircleFadeBaseTime:6,fireworkCircleFadeAddedTime:4,fireworkBaseShards:4,fireworkAddedShards:4,fireworkShardPrevPoints:4,fireworkShardBaseVel:2,fireworkShardAddedVel:1,fireworkShardBaseSize:2,fireworkShardAddedSize:2,gravity:.1,upFlow:-.1,letterContemplatingWaitTime:120,balloonSpawnTime:6,balloonBaseInflateTime:3,balloonAddedInflateTime:3,balloonBaseSize:6,balloonAddedSize:6,balloonBaseVel:.4,balloonAddedVel:.4,balloonBaseRadian:-(Math.PI/2-.5),balloonAddedRadian:-1},calc={totalWidth:opts.charSpacing*Math.max(opts.strings[0].length,opts.strings[1].length)},Tau=2*Math.PI,TauQuarter=Tau/4,letters=[];function Letter(t,i,e){this.char=t,this.x=i,this.y=e,this.dx=-ctx.measureText(t).width/2,this.dy=+opts.charSize/2,this.fireworkDy=this.y-hh;var s=i/calc.totalWidth*360;this.color="hsl(hue,80%,50%)".replace("hue",s),this.lightAlphaColor="hsla(hue,80%,light%,alp)".replace("hue",s),this.lightColor="hsl(hue,80%,light%)".replace("hue",s),this.alphaColor="hsla(hue,80%,50%,alp)".replace("hue",s),this.reset()}function Shard(t,i,e,s,h){var r=opts.fireworkShardBaseVel+opts.fireworkShardAddedVel*Math.random();this.vx=e*r,this.vy=s*r,this.x=t,this.y=i,this.prevPoints=[[t,i]],this.color=h,this.alive=!0,this.size=opts.fireworkShardBaseSize+opts.fireworkShardAddedSize*Math.random()}function generateBalloonPath(t,i,e){ctx.moveTo(t,i),ctx.bezierCurveTo(t-e/2,i-e/2,t-e/4,i-e,t,i-e),ctx.bezierCurveTo(t+e/4,i-e,t+e/2,i-e/2,t,i)}function anim(){window.requestAnimationFrame(anim),ctx.fillStyle="#111",ctx.fillRect(0,0,w,h),ctx.translate(hw,hh);for(var t=!0,i=0;i<letters.length;++i)letters[i].step(),"done"!==letters[i].phase&&(t=!1);if(ctx.translate(-hw,-hh),t)for(i=0;i<letters.length;++i)letters[i].reset()}ctx.font=opts.charSize+"px Verdana",Letter.prototype.reset=function(){this.phase="firework",this.tick=0,this.spawned=!1,this.spawningTime=opts.fireworkSpawnTime*Math.random()|0,this.reachTime=opts.fireworkBaseReachTime+opts.fireworkAddedReachTime*Math.random()|0,this.lineWidth=opts.fireworkBaseLineWidth+opts.fireworkAddedLineWidth*Math.random(),this.prevPoints=[[0,hh,0]]},Letter.prototype.step=function(){if("firework"===this.phase)if(this.spawned){++this.tick;var t=this.tick/this.reachTime,i=Math.sin(t*TauQuarter),e=t*this.x,s=hh+i*this.fireworkDy;this.prevPoints.length>opts.fireworkPrevPoints&&this.prevPoints.shift(),this.prevPoints.push([e,s,t*this.lineWidth]);for(var h=1/(this.prevPoints.length-1),r=1;r<this.prevPoints.length;++r){var a=this.prevPoints[r],l=this.prevPoints[r-1];ctx.strokeStyle=this.alphaColor.replace("alp",r/this.prevPoints.length),ctx.lineWidth=a[2]*h*r,ctx.beginPath(),ctx.moveTo(a[0],a[1]),ctx.lineTo(l[0],l[1]),ctx.stroke()}if(this.tick>=this.reachTime){this.phase="contemplate",this.circleFinalSize=opts.fireworkCircleBaseSize+opts.fireworkCircleAddedSize*Math.random(),this.circleCompleteTime=opts.fireworkCircleBaseTime+opts.fireworkCircleAddedTime*Math.random()|0,this.circleCreating=!0,this.circleFading=!1,this.circleFadeTime=opts.fireworkCircleFadeBaseTime+opts.fireworkCircleFadeAddedTime*Math.random()|0,this.tick=0,this.tick2=0,this.shards=[];var o=opts.fireworkBaseShards+opts.fireworkAddedShards*Math.random()|0,c=Tau/o,n=Math.cos(c),d=Math.sin(c);for(e=1,s=0,r=0;r<o;++r){var p=e;e=e*n-s*d,s=s*n+p*d,this.shards.push(new Shard(this.x,this.y,e,s,this.alphaColor))}}}else++this.tick,this.tick>=this.spawningTime&&(this.tick=0,this.spawned=!0);else if("contemplate"===this.phase){if(++this.tick,this.circleCreating){++this.tick2;var f=this.tick2/this.circleCompleteTime,x=-Math.cos(f*Math.PI)/2+.5;ctx.beginPath(),ctx.fillStyle=this.lightAlphaColor.replace("light",50+50*f).replace("alp",f),ctx.beginPath(),ctx.arc(this.x,this.y,x*this.circleFinalSize,0,Tau),ctx.fill(),this.tick2>this.circleCompleteTime&&(this.tick2=0,this.circleCreating=!1,this.circleFading=!0)}else if(this.circleFading){ctx.fillStyle=this.lightColor.replace("light",70),ctx.fillText(this.char,this.x+this.dx,this.y+this.dy),++this.tick2;f=this.tick2/this.circleFadeTime,x=-Math.cos(f*Math.PI)/2+.5;ctx.beginPath(),ctx.fillStyle=this.lightAlphaColor.replace("light",100).replace("alp",1-x),ctx.arc(this.x,this.y,this.circleFinalSize,0,Tau),ctx.fill(),this.tick2>=this.circleFadeTime&&(this.circleFading=!1)}else ctx.fillStyle=this.lightColor.replace("light",70),ctx.fillText(this.char,this.x+this.dx,this.y+this.dy);for(r=0;r<this.shards.length;++r)this.shards[r].step(),this.shards[r].alive||(this.shards.splice(r,1),--r);if(this.tick>opts.letterContemplatingWaitTime){this.phase="balloon",this.tick=0,this.spawning=!0,this.spawnTime=opts.balloonSpawnTime*Math.random()|0,this.inflating=!1,this.inflateTime=opts.balloonBaseInflateTime+opts.balloonAddedInflateTime*Math.random()|0,this.size=opts.balloonBaseSize+opts.balloonAddedSize*Math.random()|0;var g=opts.balloonBaseRadian+opts.balloonAddedRadian*Math.random(),w=opts.balloonBaseVel+opts.balloonAddedVel*Math.random();this.vx=Math.cos(g)*w,this.vy=Math.sin(g)*w}}else if("balloon"===this.phase)if(ctx.strokeStyle=this.lightColor.replace("light",80),this.spawning)++this.tick,ctx.fillStyle=this.lightColor.replace("light",70),ctx.fillText(this.char,this.x+this.dx,this.y+this.dy),this.tick>=this.spawnTime&&(this.tick=0,this.spawning=!1,this.inflating=!0);else if(this.inflating){++this.tick;f=this.tick/this.inflateTime,e=this.cx=this.x,s=this.cy=this.y-this.size*f;ctx.fillStyle=this.alphaColor.replace("alp",f),ctx.beginPath(),generateBalloonPath(e,s,this.size*f),ctx.fill(),ctx.beginPath(),ctx.moveTo(e,s),ctx.lineTo(e,this.y),ctx.stroke(),ctx.fillStyle=this.lightColor.replace("light",70),ctx.fillText(this.char,this.x+this.dx,this.y+this.dy),this.tick>=this.inflateTime&&(this.tick=0,this.inflating=!1)}else this.cx+=this.vx,this.cy+=this.vy+=opts.upFlow,ctx.fillStyle=this.color,ctx.beginPath(),generateBalloonPath(this.cx,this.cy,this.size),ctx.fill(),ctx.beginPath(),ctx.moveTo(this.cx,this.cy),ctx.lineTo(this.cx,this.cy+this.size),ctx.stroke(),ctx.fillStyle=this.lightColor.replace("light",70),ctx.fillText(this.char,this.cx+this.dx,this.cy+this.dy+this.size),(this.cy+this.size<-hh||this.cx<-hw||this.cy>hw)&&(this.phase="done")},Shard.prototype.step=function(){this.x+=this.vx,this.y+=this.vy+=opts.gravity,this.prevPoints.length>opts.fireworkShardPrevPoints&&this.prevPoints.shift(),this.prevPoints.push([this.x,this.y]);for(var t=this.size/this.prevPoints.length,i=0;i<this.prevPoints.length-1;++i){var e=this.prevPoints[i],s=this.prevPoints[i+1];ctx.strokeStyle=this.color.replace("alp",i/this.prevPoints.length),ctx.lineWidth=i*t,ctx.beginPath(),ctx.moveTo(e[0],e[1]),ctx.lineTo(s[0],s[1]),ctx.stroke()}this.prevPoints[0][1]>hh&&(this.alive=!1)};for(var i=0;i<opts.strings.length;++i)for(var j=0;j<opts.strings[i].length;++j)letters.push(new Letter(opts.strings[i][j],j*opts.charSpacing+opts.charSpacing/2-opts.strings[i].length*opts.charSize/2,i*opts.lineHeight+opts.lineHeight/2-opts.strings.length*opts.lineHeight/2));